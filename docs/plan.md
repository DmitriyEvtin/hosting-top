# План реализации проекта "Каталог металлопроката"

## Обзор проекта

Система каталога металлопроката с автоматическим парсингом данных с сайта bvb-alyans.ru, админ-панелью для управления товарами и интеграцией с AWS S3 для хранения изображений.

**Технологический стек:**

- **Frontend:** Next.js 15, React 19, TypeScript 5, Tailwind CSS 4, shadcn/ui
- **Backend:** PostgreSQL, Prisma ORM, Redis
- **Парсинг:** Puppeteer, Cheerio, Axios
- **Cloud:** AWS S3, CloudFront
- **DevOps:** Docker, GitHub Actions, Portainer CE
- **Мониторинг:** Sentry, Prometheus, Grafana, Loki

## Этапы реализации

### Этап 1: Инициализация проекта (1-2 недели)

#### 1.1 Настройка базовой структуры

- [ ] Создание Next.js проекта с App Router
- [ ] Настройка TypeScript конфигурации
- [ ] Установка и настройка Tailwind CSS 4
- [ ] Настройка shadcn/ui компонентов
- [ ] Создание базовой FSD структуры (app, shared слои)

#### 1.2 Настройка инструментов разработки

- [x] Настройка ESLint с FSD правилами
- [x] Настройка Prettier
- [x] Настройка Husky и lint-staged
- [x] Настройка Steiger для проверки FSD архитектуры
- [x] Настройка VS Code расширений и настроек

#### 1.3 Настройка базы данных

- [x] Установка PostgreSQL через docker compose
- [x] Настройка Prisma ORM
- [x] Создание базовой схемы БД (User, Category, Product модели)
- [x] Настройка миграций
- [x] Создание seed данных

#### 1.4 Настройка переменных окружения

- [x] Создание .env файлов для разных окружений
- [x] Настройка DATABASE_URL
- [x] Настройка NEXTAUTH конфигурации
- [x] Подготовка AWS S3 настроек

### Этап 2: Настройка тестирования (1 неделя)

#### 2.1 Настройка тестового фреймворка

- [x] Установка Jest и React Testing Library
- [x] Настройка Playwright для E2E тестов
- [x] Настройка MSW для мокирования API
- [x] Создание тестовых утилит и хелперов

#### 2.2 Написание базовых тестов

- [x] Unit тесты для shared утилит
- [x] Компонентные тесты для базовых UI компонентов
- [x] API тесты для базовых endpoints
- [x] E2E тесты для основных пользовательских сценариев

#### 2.3 Настройка CI/CD для тестирования

- [x] GitHub Actions workflow для тестов
- [x] Настройка тестовой базы данных
- [x] Настройка покрытия кода
- [x] Интеграция с Sentry для мониторинга тестов

### Этап 3: Настройка CI/CD (1 неделя)

#### 3.1 GitHub Actions настройка

- [x] Workflow для проверки кода (lint, type-check, tests)
- [x] Workflow для сборки Docker образов
- [x] Workflow для деплоя в staging/production
- [x] Настройка секретов и переменных окружения

#### 3.2 Docker конфигурация

- [x] Создание Dockerfile для development и production
- [x] Настройка docker-compose для локальной разработки
- [x] Настройка multi-stage сборки
- [x] Оптимизация размера образов

#### 3.3 Настройка мониторинга

- [ ] Интеграция Sentry для ошибок
- [ ] Настройка Prometheus + Grafana + Loki для мониторинга
  - [ ] Настройка Prometheus для сбора метрик
  - [ ] Настройка Grafana для визуализации
  - [ ] Настройка Loki для сбора логов
  - [ ] Настройка Promtail для отправки логов
  - [ ] Создание дашбордов для мониторинга приложения
  - [ ] Настройка алертов и уведомлений
- [ ] Настройка health checks
- [ ] Настройка логирования

### Этап 4: Разработка парсера (2-3 недели)

#### 4.1 Базовая архитектура парсера

- [ ] Создание BvbAlyansParser класса
- [ ] Настройка Puppeteer с оптимальными параметрами
- [ ] Создание системы логирования парсинга
- [ ] Настройка обработки ошибок и retry логики

#### 4.2 Парсинг категорий

- [ ] Создание CategoryParser
- [ ] Парсинг структуры категорий с bvb-alyans.ru
- [ ] Построение иерархии категорий
- [ ] Валидация и сохранение категорий в БД

#### 4.3 Парсинг товаров

- [ ] Создание ProductParser
- [ ] Парсинг списков товаров по категориям
- [ ] Обработка пагинации
- [ ] Сбор URL товаров для детального парсинга

#### 4.4 Парсинг деталей товаров

- [ ] Создание ProductDetailsParser
- [ ] Парсинг характеристик товаров
- [ ] Извлечение описаний и спецификаций
- [ ] Скачивание и обработка изображений

#### 4.5 Интеграция с AWS S3

- [ ] Настройка AWS SDK
- [ ] Загрузка изображений в S3
- [ ] Генерация миниатюр
- [ ] Настройка CDN через CloudFront

### Этап 5: Разработка моделей и структуры БД (1-2 недели)

#### 5.1 Расширение схемы БД

- [ ] Добавление ProductImage модели
- [ ] Добавление ProductAttribute модели
- [ ] Создание ParsingSession и ParsingLog моделей
- [ ] Настройка индексов для производительности

#### 5.2 API для работы с данными

- [ ] CRUD операции для товаров
- [ ] CRUD операции для категорий
- [ ] API для управления парсингом
- [ ] API для статистики и мониторинга

#### 5.3 Валидация данных

- [ ] Zod схемы для валидации
- [ ] Валидация изображений
- [ ] Валидация парсинга данных
- [ ] Обработка ошибок валидации

### Этап 6: Завершение парсера (1-2 недели)

#### 6.1 Оптимизация парсинга

- [ ] Батчевая обработка товаров
- [ ] Настройка задержек и rate limiting
- [ ] Оптимизация использования памяти
- [ ] Параллельная обработка

#### 6.2 Мониторинг и статистика

- [ ] Реальное время мониторинга парсинга
- [ ] Статистика успешности парсинга
- [ ] Уведомления о завершении/ошибках
- [ ] Логирование детального процесса

#### 6.3 Обработка ошибок

- [ ] Стратегии восстановления после ошибок
- [ ] Retry логика с exponential backoff
- [ ] Обработка сетевых ошибок
- [ ] Валидация и очистка данных

### Этап 7: Разработка пользовательского интерфейса (3-4 недели)

#### 7.1 Базовые страницы

- [ ] Главная страница с каталогом
- [ ] Страница категории товаров
- [ ] Страница детального просмотра товара
- [ ] Страница поиска и фильтрации

#### 7.2 Компоненты каталога

- [ ] ProductCard компонент
- [ ] ProductList компонент
- [ ] SearchWidget компонент
- [ ] FiltersWidget компонент

#### 7.3 Админ-панель

- [ ] Дашборд с статистикой
- [ ] Управление товарами (CRUD)
- [ ] Управление категориями
- [ ] Мониторинг парсинга
- [ ] Управление пользователями

### Этап 8: Система аутентификации (1-2 недели)

#### 8.1 Настройка NextAuth.js

- [x] Конфигурация провайдеров
- [x] Настройка JWT токенов
- [x] Создание системы ролей
- [x] Защита API routes

#### 8.2 Управление пользователями

- [ ] Регистрация и авторизация
- [ ] Управление профилями
- [ ] Восстановление паролей
- [ ] Аудит действий пользователей

### Этап 9: Оптимизация и производительность (1-2 недели)

#### 9.1 Frontend оптимизация

- [ ] Code splitting и lazy loading
- [ ] Оптимизация изображений
- [ ] Кэширование данных
- [ ] SEO оптимизация

#### 9.2 Backend оптимизация

- [ ] Оптимизация запросов к БД
- [ ] Кэширование с Redis
- [ ] CDN настройка
- [ ] Мониторинг производительности

### Этап 10: Тестирование и деплой (1-2 недели)

#### 10.1 Комплексное тестирование

- [ ] Unit тесты для всех компонентов
- [ ] Integration тесты для API
- [ ] E2E тесты для пользовательских сценариев
- [ ] Performance тесты
- [ ] Security тесты

#### 10.2 Production деплой

- [ ] Настройка production окружения
- [ ] SSL сертификаты
- [ ] Мониторинг и алерты
- [ ] Backup стратегия
- [ ] Документация для пользователей

## Временные рамки

**Общая продолжительность:** 12-16 недель (3-4 месяца)

### Критический путь

1. **Этапы 1-3** (3-4 недели) - Базовая настройка
2. **Этапы 4-6** (4-6 недель) - Парсинг данных
3. **Этапы 7-8** (4-5 недель) - Пользовательский интерфейс
4. **Этапы 9-10** (2-3 недели) - Оптимизация и деплой

### Параллельная разработка

- Этапы 4-5 можно выполнять параллельно
- Этапы 7-8 можно начинать после завершения этапа 5
- Этап 9 можно выполнять параллельно с этапом 10

## Риски и митигация

### Технические риски

- **Изменения структуры сайта bvb-alyans.ru** - Создание адаптивного парсера
- **Производительность парсинга** - Оптимизация и батчевая обработка
- **Ограничения AWS** - Мониторинг использования и оптимизация
- **Мониторинг инфраструктуры** - Настройка Prometheus для отслеживания всех компонентов

### Бизнес риски

- **Время разработки** - Регулярные демо и фидбек
- **Качество данных** - Валидация и тестирование парсинга
- **Масштабируемость** - Архитектурные решения с учетом роста

## Метрики успеха

### Технические метрики

- **Покрытие тестами:** > 80%
- **Время парсинга:** < 2 часов
- **Время загрузки страниц:** < 2 секунд
- **Uptime:** > 99.9%
- **Мониторинг:** Prometheus метрики для всех критических компонентов
- **Логирование:** Централизованные логи через Loki
- **Алерты:** Автоматические уведомления при превышении порогов

### Бизнес метрики

- **Покрытие каталога:** 100% товаров с bvb-alyans.ru
- **Актуальность данных:** Обновление каждые 24 часа
- **Пользовательский опыт:** Интуитивный интерфейс
- **Административная эффективность:** Автоматизация ручных процессов

## Следующие шаги

1. **Немедленно:** Начать с Этапа 1 - инициализация проекта
2. **На этой неделе:** Завершить настройку базовой структуры
3. **В течение месяца:** Завершить этапы 1-3 и начать разработку парсера
4. **Регулярно:** Еженедельные демо и ретроспективы

---

_План будет обновляться по мере прогресса разработки и получения фидбека._
