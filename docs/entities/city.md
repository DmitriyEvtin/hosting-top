# Сущность "Город"

## Описание

Сущность "Город" предназначена для управления списком городов в CRM системе. Включает в себя базовые CRUD операции, поиск и управление правами доступа.

## Структура

### Модель данных

- `id` - Уникальный идентификатор (cuid)
- `name` - Название города (уникальное, до 100 символов)
- `createdAt` - Дата создания
- `updatedAt` - Дата последнего обновления

### Архитектура (FSD)

```
src/entities/city/
├── api/
│   ├── city-api.ts          # API функции для работы с городами
│   └── index.ts
├── model/
│   ├── types.ts             # TypeScript типы
│   ├── validation.ts         # Zod схемы валидации
│   └── index.ts
├── ui/
│   ├── CityTable/           # Компонент таблицы городов
│   ├── CityForm/            # Компонент формы города
│   └── index.ts
└── index.ts
```

## API Endpoints

### GET /api/cities

Получить список городов с поиском и пагинацией.

**Параметры:**

- `search` (string, optional) - Поиск по названию города
- `page` (number, optional) - Номер страницы (по умолчанию 1)
- `limit` (number, optional) - Количество элементов на странице (по умолчанию 10)

**Ответ:**

```json
{
  "cities": [
    {
      "id": "string",
      "name": "string",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "total": 100,
  "page": 1,
  "limit": 10,
  "totalPages": 10
}
```

### POST /api/cities

Создать новый город.

**Тело запроса:**

```json
{
  "name": "Название города"
}
```

**Ответ:** 201 Created с данными созданного города

### GET /api/cities/[id]

Получить город по ID.

**Ответ:** Данные города или 404 Not Found

### PUT /api/cities/[id]

Обновить город.

**Тело запроса:**

```json
{
  "name": "Новое название города"
}
```

**Ответ:** Данные обновленного города

### DELETE /api/cities/[id]

Удалить город.

**Ответ:** Данные удаленного города

## Права доступа

- **Менеджер (MANAGER)** - Полный доступ к управлению городами
- **Админ (ADMIN)** - Наследует все права менеджера
- **Остальные роли** - Доступ запрещен (403 Forbidden)

## Валидация

### Создание города

- `name` - обязательное поле, 1-100 символов, обрезается от пробелов

### Обновление города

- `name` - обязательное поле, 1-100 символов, обрезается от пробелов

### Поиск

- `search` - необязательное поле для частичного поиска по названию
- `page` - номер страницы (минимум 1)
- `limit` - количество элементов (1-100)

## Ограничения

1. **Уникальность названия** - Название города должно быть уникальным
2. **Длина названия** - Максимум 100 символов
3. **Права доступа** - Только менеджеры и админы могут управлять городами

## Использование в CRM

Страница управления городами доступна по адресу `/cities` в CRM разделе.

### Функциональность:

- Просмотр списка городов с пагинацией
- Поиск по названию города
- Создание нового города
- Редактирование существующего города
- Удаление города с подтверждением

### UI Компоненты:

- `CityTable` - Таблица с городами и действиями
- `CityForm` - Форма для создания/редактирования города

## Миграции

Для добавления модели City в базу данных выполните:

```bash
npx prisma migrate dev --name add_city_model
```

## Тестирование

Тесты для сущности города находятся в:

- `tests/unit/entities/city.test.ts` - Юнит тесты для API функций
- `tests/integration/city-api.test.ts` - Интеграционные тесты для API endpoints

Запуск тестов:

```bash
npm test -- tests/unit/entities/city.test.ts
npm test -- tests/integration/city-api.test.ts
```
