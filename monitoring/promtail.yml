server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  - job_name: traefik-access
    static_configs:
      - targets:
          - localhost
        labels:
          job: traefik-access
          __path__: /var/log/traefik/access.log
    pipeline_stages:
      - regex:
          expression: '^(?P<remote_addr>\S+) \S+ \S+ \[(?P<timestamp>[^\]]+)\] "(?P<method>\S+) (?P<path>\S+) (?P<protocol>\S+)" (?P<status>\d+) (?P<size>\d+) "(?P<referer>[^"]*)" "(?P<user_agent>[^"]*)"'
      - timestamp:
          source: timestamp
          format: "02/Jan/2006:15:04:05 -0700"
      - labels:
          method:
          status:
          path:
      - metrics:
          status_code_total:
            type: Counter
            description: "Total number of requests by status code"
            source: status
            config:
              action: inc
          request_duration_seconds:
            type: Histogram
            description: "Request duration in seconds"
            source: request_duration
            config:
              buckets: [0.1, 0.5, 1, 2, 5, 10]

  - job_name: traefik-main
    static_configs:
      - targets:
          - localhost
        labels:
          job: traefik-main
          __path__: /var/log/traefik/traefik.log
    pipeline_stages:
      - regex:
          expression: '^(?P<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d+Z) (?P<level>\w+) (?P<message>.*)'
      - timestamp:
          source: timestamp
          format: "2006-01-02T15:04:05.000Z"
      - labels:
          level:
      - metrics:
          log_entries_total:
            type: Counter
            description: "Total number of log entries by level"
            source: level
            config:
              action: inc
